<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartDine - Sign In / Sign Up</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/style.css">
</head>

<body >

<header class="site-header">
    <div class="header-inner">
        <div class="brand">SmartDine</div>
        <nav class="nav-links">
            <a href="home.html">Home</a>
            <a href="about.html">About Us</a>
            <div id="navRightArea">
                <a href="restaurant.html" class="btn-order">Order Now</a>
            </div>
        </nav>
    </div>
</header>

<div class="auth-container">
    <div class="auth-box">
        <div id="messageArea" style="display: none;"></div>

        <form id="signInForm">
            <h2>Sign In</h2>

            <div class="form-group">
                <label for="signInUsername">Username</label>
                <input type="text" id="signInUsername" placeholder="Enter your username" required>
            </div>

            <div class="form-group">
                <label for="signInPassword">Password</label>
                <input type="password" id="signInPassword" placeholder="Enter your password" required>
            </div>

            <button class="btn-primary" type="submit">Sign In</button>

            <div class="auth-toggle">
                New here? <strong>Register now to order and enjoy delicious dishes!</strong>
                <button type="button" onclick="toggleAuth(false)">Sign Up</button>
            </div>
        </form>

        <form id="signUpForm">
            <h2>Sign Up</h2>

            <div class="form-group">
                <label for="signUpUsername">Username</label>
                <input type="text" id="signUpUsername" placeholder="Create a username" required>
            </div>

            <div class="form-group">
                <label for="signUpEmail">Email</label>
                <input type="email" id="signUpEmail" placeholder="you@email.com" required>
            </div>

            <div class="form-group">
                <label for="signUpPassword">Password</label>
                <input type="password" id="signUpPassword" placeholder="Create a strong password" required>
            </div>

            <button class="btn-primary" type="submit">Register</button>

            <div class="auth-toggle">
                Already have an account?
                <button type="button" onclick="toggleAuth(true)">Sign In</button>
            </div>
        </form>

    </div>
</div>

<script>
    const BASE_URL = 'http://localhost:8080/api/auth';
    
    function showMessage(type, message) {
        const messageArea = document.getElementById('messageArea');
        messageArea.textContent = message;
        messageArea.className = type === 'success' ? 'success' : 'error';
        messageArea.style.display = 'block';
        setTimeout(() => {
            messageArea.style.display = 'none';
        }, 5000);
    }

    function toggleAuth(showSignIn) {
        document.getElementById('signInForm').style.display = showSignIn ? 'block' : 'none';
        document.getElementById('signUpForm').style.display = showSignIn ? 'none' : 'block';
    }
    
    async function handleSignIn(event) {
        event.preventDefault();

        const username = document.getElementById('signInUsername').value;
        const password = document.getElementById('signInPassword').value;

        try {
            const response = await fetch(`${BASE_URL}/signin`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    username: username, 
                    password: password 
                }),
                credentials: 'include'
            });

            if (response.ok) {
                sessionStorage.setItem('username', username);
                showMessage('success', 'Login successful! Redirecting to your Profile...');
                
                setTimeout(() => {
                    window.location.href = 'user.html'; 
                }, 1000);

            } else {
                const errorData = await response.json().catch(() => ({ message: "Invalid credentials or server error." }));
                showMessage('error', errorData.message || 'Login failed. Check username and password.');
            }
        } catch (error) {
            console.error('Network Error:', error);
            showMessage('error', 'Network error. Is the backend server running?');
        }
    }

    async function handleSignUp(event) {
        event.preventDefault();

        const username = document.getElementById('signUpUsername').value;
        const email = document.getElementById('signUpEmail').value;
        const password = document.getElementById('signUpPassword').value;

        try {
            const response = await fetch(`${BASE_URL}/signup`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    username: username, 
                    email: email, 
                    password: password 
                })
            });

            const data = await response.json();

            if (response.ok) {
                showMessage('success', data.message + ' Please sign in now.');
                setTimeout(() => {
                    toggleAuth(true); 
                }, 1500);
                
            } else {
                showMessage('error', data.message || 'Registration failed.');
            }
        } catch (error) {
            console.error('Network Error:', error);
            showMessage('error', 'Network error. Could not reach the server.');
        }
    }
    document.getElementById("signInForm").addEventListener("submit", handleSignIn);
    document.getElementById("signUpForm").addEventListener("submit", handleSignUp);
</script>

</body>
</html>